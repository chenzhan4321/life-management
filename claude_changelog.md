# Claude 更新日志

## v5.0.4 (2025-08-27)
### 修复
- 🐛 **修复已完成任务时间不显示在域分配中的问题**
  - updateDomainDisplay 现在使用包含已完成任务的 allTasks
  - 已完成任务的时间正确计入域时间统计
  - 确保已完成部分显示为深色（opacity 1.0）

## v5.0.3 (2025-08-27)
### 修复
- 🐛 **修复 uncomplete API 的 CORS 错误**
  - 为所有 uncomplete 端点响应添加 CORS 头
  - 确保前端可以正确调用恢复任务的 API
  - 解决跨域请求被阻止的问题

## v5.0.2 (2025-08-27)
### 修复多个严重问题
- 🐛 **修复域更改提示错误**
  - 修正 API 响应格式检查（支持 status: 'success'）
  - 域更改现在正确显示成功提示
  
- 🐛 **修复已完成任务显示问题**
  - 修复缺失的 completed_date 字段
  - 将已完成任务正确移动到归档文件
  - 今日已完成任务现在正确显示所有3个任务
  
- 🎨 **修复时间统计显示**
  - 已完成任务时间正确显示为深色（不透明度 1.0）
  - 任务完成后时间统计立即更新

## v5.0.1 (2025-08-27)
### 修复
- 🐛 **修复已归档任务无法删除问题**
  - DELETE API 现在支持删除已归档的任务
  - 自动检测任务是否在归档中并正确删除
  - 修复 404 错误

## v5.0 (2025-08-27)
### 重大更新 - 公开访问模式
- 🌐 **权限模型重构**
  - 未登录用户可以查看所有任务（只读模式）
  - 无需登录即可浏览任务列表
  - 登录后获得完整编辑权限
  
- 🔒 **只读模式实现**
  - 未登录用户无法编辑、删除或完成任务
  - AI 输入区域显示登录提示
  - 所有交互控件根据登录状态动态启用/禁用
  
- 🎨 **界面优化**
  - 右上角动态显示登录/注册按钮或用户信息
  - 只读模式下任务显示视觉区分
  - 平滑的权限切换体验

## v4.9 (2025-08-27)
### 新功能
- 👥 **多用户支持**
  - 创建登录页面，支持用户名密码登录
  - 用户可以选择个性化 emoji 头像
  - 自动注册新用户（首次登录时）
  
- 🔐 **用户认证与会话管理**
  - 检查登录状态，未登录自动跳转
  - 显示当前用户信息和头像
  - 提供登出功能
  
- 📊 **任务优先级显示**
  - 当前用户的任务永远显示在最前面
  - 其他用户的任务显示 @用户名 标识
  - 任务按用户和优先级智能排序
  
- 💾 **数据隔离**
  - 每个任务关联创建用户
  - 后端支持 username 字段
  - 前端自动添加当前用户信息

## v4.8.1 (2025-08-27)
### 修复
- 🐛 **增强已完成任务恢复功能**
  - 改进任务状态判断逻辑，支持 completed_at 字段检测
  - 添加更详细的调试日志输出
  - 修复取消勾选已完成任务的状态检测问题

### 更新
- 📝 **统一版本号显示**
  - 更新所有页面显示的版本号从v4.4到v4.8
  - 确保前后端版本号一致性

## v4.8 (2025-08-27)
### 新功能
- ✨ **支持恢复已完成的任务**
  - 添加专门的API端点 `/api/tasks/{task_id}/uncomplete`
  - 已归档的任务可以恢复到未完成状态
  - 前端自动判断并使用正确的API
  
### 修复
- 🐛 **修复已完成任务无法恢复的问题**
  - 解决了已归档任务404错误
  - 已完成任务现在可以正常恢复到未完成状态

---

## v4.7 (2025-08-27)
### 修复
- 🐛 **修复clearTaskReminder未定义错误**
  - 注释掉未定义的函数调用
  
- 🐛 **修复已完成任务404错误**
  - 已归档的任务不再尝试更新
  - 在updateTaskField中跳过已完成任务
  
- 🔧 **优化今日已完成任务显示**
  - 添加专门的API调用获取今日已完成任务
  - 合并活动任务和已完成任务数据
  - 确保今日已完成区域稳定显示

## v4.6 (2025-08-27)
### 新功能
- 📊 **任务按优先级排序**
  - 任务列表自动按优先级排序（1最高，5最低）
  - 相同优先级按创建时间排序
  
- 📚 **历史任务管理系统**  
  - 完成的任务自动移到历史文件（data/completed_tasks.json）
  - 支持查看今日完成的任务（/api/tasks/completed/today）
  - 完成任务不再占用主任务列表空间
  
- 📈 **改进的统计数据**
  - 每日统计只显示今日完成的任务
  - 准确的生产力评分计算

---

## v4.5 (2025-08-27)
### 改进
- 🎯 **优化AI任务分类准确性**
  - 强化了提示词工程，使任务分类更准确
  - 添加了详细的分类规则和示例
  - 修复了JSON格式响应要求
  - 降低温度参数(0.7→0.3)提高准确性
  - 现在能正确识别：
    - academic：算法、编程、研究任务
    - income：财务、报销、银行事务
    - growth：新技术探索、个人成长
    - life：日常邮件、生活事务
  - 智能识别任务中的时间标记(如60m)
  - 根据关键词智能调整优先级

---

## v4.4 (2025-08-27)
### 重大改进
- 🤖 **AI 处理全面优化**
  - 每一行文本都作为独立任务处理，不再合并
  - 添加历史任务作为参考，提高分类准确度
  - 优化提示词，明确时间估算规则
  - 验证AI返回任务数量，自动补全缺失任务

### 修复
- 🐛 修复批量删除后选中按钮不消失问题
  - 更新所有删除按钮状态

---

## v4.3 (2025-08-27)
### 优化
- 🤖 **AI 处理逻辑改进**
  - 修改为分析每一行任务，而不是生成新任务
  - 保持原始任务标题，只添加结构化信息
  - AI 处理的任务直接放入任务池（status: 'pool'）

### 修复  
- 🔧 修复 AI 处理超时问题
  - 将超时时间从 30秒增加到 60秒
  - 修复前端响应判断逻辑
  - 支持 created_tasks 和 status 两种响应格式

---

## v4.2.1 (2025-08-27)
### 修复
- 🐛 修复任务池和待完成任务重复显示问题
  - 任务池只显示 `status: 'pool'` 的任务
  - 新添加的任务默认为 `pending` 状态，不再放入任务池
  - 避免同一任务在两个区域重复显示

---

## v4.2 (2025-08-27)
### 重大更新
- 🎯 **实现数据持久化存储**
  - 使用 JSON 文件存储所有任务数据
  - 数据文件位置：`data/tasks.json`
  - 服务重启后数据自动恢复

### 技术细节
- 📂 自动创建 `data` 目录
- 💾 每次增删改操作后自动保存
- 🔄 启动时自动加载已有数据
- 🔒 使用异步锁防止并发写入冲突

### 优化
- ⚡ 异步保存，不阻塞主线程
- 📝 控制台显示保存/加载状态
- 🛡️ 错误处理和恢复机制

---

## v4.1 (2025-08-27)
### 修复
- 🐛 修复删除任务时显示"删除失败"但实际成功的问题
  - 原因：后端返回 `status: "success"`，前端检查 `data.success`
  - 解决：统一后端响应格式为 `{success: true, message: "..."}`

### 新增
- 📝 创建本地 CLAUDE.md 文件，添加项目规范和数据库保护指令
- 🔒 明确数据库管理规则：永不删除 tasks_db 数据

### 说明
- 💾 当前数据存储在内存中（`tasks_db = {}`），服务重启后会重置
- 📊 未来可考虑实现持久化存储（SQLite或JSON文件）

---

## v4.0 (2025-08-27)
### 重大更新
- 🤖 集成 DeepSeek AI API，实现智能任务分解
- 🏗️ 重构为前后端分离架构
- 🧹 清理项目文件（1.8GB → 4.9MB）
- 🚀 准备 GitHub Pages + Vercel 部署

### 功能
- ✨ AI 智能处理：输入自然语言，自动分解为结构化任务
- 🔐 API密钥后端管理，确保安全性
- 📊 支持四大领域：学术/收入/成长/生活

### 修复
- 🐛 修复 API 端点路径（/tasks → /api/tasks）
- 🐛 修复 PUT/PATCH 405 错误
- 🐛 修复浅色主题显示问题
- 🐛 修复 Service Worker 缓存问题

---

## v3.7 (2025-08-27)
### 修复
- 修复 API 连接问题
- 修复任务更新方法错误
- 完善浅色主题样式

---

## v3.6.1 (2025-08-27)
### 初始版本
- 基础任务管理功能
- 深色/浅色主题切换
- PWA 支持