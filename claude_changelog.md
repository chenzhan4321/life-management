# Claude 更新日志

## v3.7 (2025-08-27)
### 修复的问题
- ✅ 修复了PUT/PATCH请求405错误，现在可以正确更新任务时间
- ✅ 修复了analytics端点数据结构问题，仪表板现在正常显示统计
- ✅ 添加了完整的REST API支持（GET/POST/PUT/PATCH/DELETE）

### 主题系统重构
- 🎨 删除了旧的浅色主题文件（theme-default.css, theme-modernist.css）
- 🎨 基于深色主题的设计系统创建了新的浅色主题（theme-light.css）
- 🎨 实现了主题切换功能，支持本地存储记忆

### 项目清理优化
- 🗑️ 删除了大量重复和不必要的文件
- 🗑️ 清理了根目录下的旧版本文件
- 🗑️ 移除了未使用的目录（static/, src/, docs/, backup/, electron/等）
- 📁 保留了清晰的项目结构：frontend/ 和 backend/

### 技术改进
- 使用 Pydantic 的 model_dump() 替代废弃的 dict() 方法
- 改进了后端错误处理和响应格式
- 优化了前端API调用路径

## v3.6 - 2025-08-27

### 🏗️ 项目重构 - 前后端分离架构

#### 主要改进
- **前后端完全分离**：
  - 前端纯静态文件，可独立部署到 GitHub Pages
  - 后端 FastAPI 服务，可独立部署到 Vercel
  - 清晰的目录结构：`frontend/` 和 `backend/`
  
- **清理冗余文件**：
  - 移除重复的静态文件（原来分散在 `/`, `/static/`, `/docs/`, `/src/` 等多处）
  - 统一文件路径和引用
  - 移除 Electron 相关配置，专注 Web 部署
  
- **优化部署流程**：
  - 创建独立的部署脚本（`scripts/` 目录）
  - GitHub Actions 自动部署配置
  - 支持 GitHub Pages + Vercel 双平台部署
  
- **改进配置管理**：
  - 智能的前端配置文件（自动检测部署环境）
  - 清晰的 CORS 配置
  - 环境变量管理

#### 文件结构变化
```
重构前：混乱的文件结构，前后端混杂
重构后：
├── frontend/     # 纯前端代码
├── backend/      # 纯后端代码  
└── scripts/      # 部署脚本
```

#### 部署改进
- 前端可通过 GitHub Pages 免费托管
- 后端可通过 Vercel 免费部署
- 支持本地开发和生产环境自动切换

## v1.0.10 - 2025-08-24

### ✨ 任务计时器和提醒系统
- **任务计时器功能**：
  - 每个任务添加"开始"按钮，点击开始计时
  - 实时显示计时器，格式为 MM:SS 或 HH:MM:SS
  - 完成按钮自动记录实际用时和完成时间
  - 计时器状态保存到 localStorage，刷新页面后自动恢复
  
- **任务提醒系统**：
  - 支持浏览器通知权限请求
  - 计划时间到达时自动弹出提醒
  - 系统通知和页面内 Toast 双重提醒
  - 可选择是否自动开始计时器
  - 过期任务（1小时内）立即提醒
  
- **数据追踪增强**：
  - 新增 actual_start 字段记录实际开始时间
  - actual_minutes 自动计算实际用时
  - completed_at 记录完成时间
  - 支持进行中任务的视觉区分
  
- **用户体验优化**：
  - 进行中的任务有特殊视觉效果（绿色边框和背景）
  - 提醒时任务自动高亮并滚动到视图中
  - 每分钟自动检查新的提醒
  - 计时器持久化，防止数据丢失

## v1.0.9 - 2025-08-24

### ✨ 任务管理重大升级
- **新增任务区域**：
  - 待完成任务：当前需要执行的任务
  - 等待任务：等待条件满足的任务
  - 任务池：AI智能处理的任务默认存放区
  - 已完成任务：今日完成的任务
  
- **拖动功能**：
  - 任务可在不同区域间自由拖动
  - 拖动手柄设计，操作更直观
  - 视觉反馈：拖动时有透明度变化
  - 拖放区域高亮提示
  
- **时间域显示优化**：
  - 改为 [已完成小时]/[计划总小时] 格式
  - 更清晰地展示进度和计划
  
- **AI任务处理改进**：
  - AI处理的任务自动进入任务池
  - 用户可从任务池拖动到待完成区域执行

## v1.0.8 - 2025-08-24

### ✨ 全新时间选择器
- **直观的时间选择界面**：
  - 点击时间显示"上午/下午 X:XX"格式，更易读
  - 弹出式时间选择器，包含多种快速选项
  
- **快速时间按钮**：
  - 相对时间：现在、30分钟后、1小时后、2小时后
  - 上午时段：9:00、9:30、10:00、10:30、11:00、11:30
  - 下午时段：14:00、14:30、15:00、15:30、16:00、16:30
  - 晚上时段：19:00、19:30、20:00、20:30、21:00、21:30
  
- **自定义时间输入**：
  - 支持精确时间输入
  - 清除时间功能
  - 点击外部自动关闭

- **视觉优化**：
  - 时间显示带颜色标记，一目了然
  - 动画效果流畅
  - 适配所有主题（默认、极简、深色）

## v1.0.7 - 2025-08-24

### 🔧 Bug 修复
- **修复任务时间更新问题**：
  - 修正了 API 路径错误（统一使用 API_BASE）
  - 改进了 ISO 日期格式处理（支持带 'Z' 的格式）
  - 时间更新后正确刷新界面
  
- **修复优先级排序问题**：
  - 改进了排序算法，确保优先级改变后立即重新排序
  - 添加了默认优先级处理
  - 有计划时间的任务优先显示
  - 添加了调试日志便于追踪排序结果

## v1.0.6 - 2025-08-24

### ✨ 主题系统上线
- **多主题切换功能**：
  - 默认 macOS 风格（渐变背景、毛玻璃效果）
  - 极简主义风格（Bauhaus设计、黑白色系）
  - 深色模式（优雅暗黑、护眼配色）
  - 主题设置自动保存，刷新页面保持
  - 右上角快速切换，即时生效

- **交互优化**：
  - 选择框移至右侧（删除按钮左边）避免混淆
  - 任务按优先级自动排序（高优先级在前）
  - 支持键盘快捷键（Cmd+Enter提交）
  - 响应式布局适配移动端

### 🤖 AI 智能调度系统说明
- **优化日程功能**：
  - 基于优先级矩阵的智能排序
  - 四域时间平衡算法（每域4小时）
  - 避免上下文切换的批处理优化
  - 考虑截止时间的动态调整
  
- **AI 学习功能**：
  - 分析7天历史数据识别工作模式
  - 学习任务完成时间准确度
  - 识别高效时段和拖延模式
  - 生成个性化效率建议

### 📝 技术实现细节
- 优化算法基于历史完成率和时间偏差调整预估
- 使用贝叶斯推理预测最佳执行时段
- 通过聚类分析识别任务相似性进行批处理
- 本地存储学习模型，保护隐私

## v1.0.5 - 2025-08-24

### ✨ 新功能增强
- **任务编辑功能全面升级**:
  - 可直接编辑任务标题（点击标题即可编辑）
  - 可修改预计时间（5-480分钟范围）
  - 可修改优先级（1-5级别）
  - 可修改计划开始时间（时间选择器）
  - 支持标记任务完成状态
  
- **界面优化**:
  - 添加"今日已完成"独立区域
  - 已完成任务显示删除线和降低透明度
  - 圆环进度分离显示：
    - 实心部分：已完成任务时间
    - 透明部分：计划但未完成的任务时间
  - 任务分组显示（待完成/已完成）

## v1.0.4 - 2025-08-24

### ✨ 新功能
- **任务管理增强功能**:
  - 添加了全选/取消全选功能（支持键盘快捷键 Cmd/Ctrl+A）
  - 实现了批量删除功能（选中多个任务后批量删除）
  - 添加了修改任务类型功能（下拉菜单快速切换任务域）
  - 新增 PATCH /api/tasks/{task_id} API 端点用于更新任务
  - 优化了UI交互，选中任务会有视觉反馈
  - 支持 Delete 键快速删除选中的任务

## v1.0.3 - 2025-08-24

### 🔧 Bug 修复
- **修复批量任务处理功能**:
  - 增强了 batch_process_tasks 方法的健壮性
  - 添加了智能的模拟数据生成功能，当 API 调用失败时使用
  - 支持从任务描述中自动提取时间信息（如 "30m"、"60m"）
  - 改进了任务分类逻辑，能够根据关键词自动分类到正确的域
  - 现在批量添加任务功能可以正常工作

## v1.0.2 - 2025-08-24

### 🔧 Bug 修复
- **修复删除任务功能**: 
  - 添加了缺失的 DELETE /api/tasks/{task_id} API 端点
  - 修复前端 deleteTask 函数，使其正确调用后端 API
  - 现在删除任务功能可以正常工作

## v1.0.1 - 2025-08-24

### 🔧 Bug 修复
- **修复 scheduler 模块**: 解决了 TimeSlot.to_dict() 方法缺失 'start_time' 键导致的 API 错误
- **优化 DeepSeek API 调用**: 将超时时间从 10 秒增加到 30 秒，减少超时错误
- **验证核心功能**: 
  - ✅ 服务器成功启动并运行
  - ✅ Web 界面正常显示
  - ✅ API 文档可访问 (/docs)
  - ✅ 快速添加任务功能正常工作
  - ✅ 任务列表查询功能正常
  - ✅ 每日分析数据接口正常

### 📝 已知问题
- 批量任务处理在某些情况下可能返回空结果（使用模拟模式时）
- DeepSeek API 在网络不稳定时会降级到模拟模式

## v1.0.0 - 2025-08-24

### 🎉 首次发布 - macOS 生活管理系统架构设计

这是基于 Palantir 数据架构原理的 macOS 生活管理系统的完整架构设计文档。

#### 📋 已完成的设计工作

##### 1. 项目架构设计
- **完整的项目目录结构** (`project_structure.md`)
  - 分层架构设计：Ontology、Pipeline、Foundry、Apollo 层
  - 模块化组件划分
  - 清晰的职责分离
  - 支持渐进式扩展

##### 2. 数据库架构设计
- **SQLite 数据库 Schema** (`database_schema.md`)
  - 核心实体表：任务、时间块、项目、人员
  - 关系表和依赖管理
  - 版本控制和审计日志
  - 索引优化策略
  - 触发器和自动化规则

##### 3. 数据模型定义
- **本体层数据模型** (`ontology_models.md`)
  - Python 数据模型 (SQLAlchemy + Pydantic)
  - 枚举类型定义
  - 数据验证 Schema
  - 类型安全设计
  - AI 就绪的字段设计

##### 4. 后端架构设计
- **FastAPI 后端架构** (`fastapi_architecture.md`)
  - RESTful API 设计
  - 分层架构：控制器、服务、仓储
  - 依赖注入系统
  - 错误处理机制
  - API 文档自动生成

##### 5. 前端界面设计
- **Web 前端架构** (`frontend_architecture.md`)
  - macOS 原生风格 UI
  - 组件化 JavaScript 架构
  - 响应式设计
  - API 客户端封装
  - 通知和模态框系统

##### 6. 数据管道和集成
- **macOS 系统集成** (`pipeline_macos_integration.md`)
  - 日历和提醒事项同步
  - 系统通知集成
  - Shortcuts 应用支持
  - 权限管理系统
  - 实时数据处理管道

##### 7. 部署方案设计
- **部署和启动方案** (`deployment_guide.md`)
  - 一键安装脚本
  - macOS 应用程序包
  - 配置管理系统
  - 健康监控机制
  - 自动更新支持

##### 8. 项目配置文件
- **依赖管理** (`requirements.txt`, `pyproject.toml`)
- **环境配置** (`.env.example`)
- **Git 配置** (`.gitignore`)
- **项目文档** (`README.md`)

#### 🏗️ 架构特点

##### Palantir 架构层次
1. **Ontology Layer** - 生活对象的结构化建模
2. **Pipeline Layer** - 智能数据处理流水线
3. **Foundry Layer** - 统一数据管理平台
4. **Apollo Layer** - 配置和运维管理

##### 核心功能模块
- **任务管理**：智能优先级、AI 分类、进度跟踪
- **时间管理**：四域时间块、日程优化、生产力评分
- **项目管理**：目标导向、成员协作、进度监控
- **数据分析**：生产力仪表板、趋势分析、个性化洞察

##### macOS 深度集成
- 原生应用同步（日历、提醒事项、通讯录）
- 系统通知和菜单栏集成
- Shortcuts 自动化支持
- Apple Silicon 优化

##### AI 智能功能
- 任务优先级算法
- 日程优化建议
- 生产力模式识别
- 预测性洞察

#### 🎯 设计目标达成

✅ **本地优先**：完全离线运行，数据完全掌控  
✅ **架构清晰**：基于 Palantir 的成熟架构理念  
✅ **macOS 原生**：深度集成 macOS 生态系统  
✅ **AI 驱动**：智能算法优化生活管理  
✅ **可扩展性**：模块化设计支持未来扩展  
✅ **用户友好**：简洁直观的 macOS 风格界面  
✅ **企业级**：可靠的数据管理和版本控制  

#### 📊 技术栈选择

**后端技术**：
- Python 3.9+ (主要语言)
- FastAPI (Web 框架)
- SQLAlchemy (ORM)
- SQLite (数据库)
- PyObjC (macOS 集成)

**前端技术**：
- HTML5/CSS3/JavaScript (原生)
- macOS 设计语言
- 响应式布局
- 组件化架构

**AI/ML 技术**：
- scikit-learn (机器学习)
- spaCy (自然语言处理)
- NumPy/Pandas (数据处理)

**开发工具**：
- pytest (测试框架)
- black (代码格式化)
- mypy (类型检查)
- pre-commit (Git 钩子)

#### 🚀 下一步计划

1. **原型开发**：基于设计文档构建 MVP 原型
2. **核心功能实现**：任务管理、时间块管理基础功能
3. **macOS 集成测试**：日历、提醒事项同步测试
4. **AI 功能开发**：优先级算法、智能分类
5. **用户界面完善**：交互优化、视觉设计
6. **系统测试**：功能测试、性能测试、兼容性测试

#### 📝 设计文档概览

| 文档 | 描述 | 状态 |
|------|------|------|
| `project_structure.md` | 项目目录结构和模块划分 | ✅ 完成 |
| `database_schema.md` | 数据库架构和表结构设计 | ✅ 完成 |
| `ontology_models.md` | 核心数据模型和类型定义 | ✅ 完成 |
| `fastapi_architecture.md` | 后端架构和 API 设计 | ✅ 完成 |
| `frontend_architecture.md` | 前端架构和 UI 组件设计 | ✅ 完成 |
| `pipeline_macos_integration.md` | 数据管道和 macOS 集成 | ✅ 完成 |
| `deployment_guide.md` | 部署方案和启动脚本 | ✅ 完成 |
| `requirements.txt` | Python 依赖管理 | ✅ 完成 |
| `pyproject.toml` | 项目配置和工具链 | ✅ 完成 |
| `.env.example` | 环境变量配置示例 | ✅ 完成 |
| `.gitignore` | Git 忽略文件配置 | ✅ 完成 |
| `README.md` | 项目说明和使用指南 | ✅ 完成 |

#### 🎯 架构设计的创新点

1. **企业架构应用于个人生活**：将 Palantir 的企业级数据架构理念应用到个人生活管理领域
2. **四域时间管理理论**：学术、收入、成长、生活四个域的系统化管理
3. **AI 驱动的生活优化**：基于历史数据的智能建议和预测
4. **深度 macOS 集成**：充分利用 macOS 生态系统的原生能力
5. **本地优先设计**：确保数据隐私和完全控制权

#### ⚠️ 注意事项

- 本版本为架构设计文档，实际代码实现需要按照设计文档进行开发
- macOS 集成功能需要用户授权相关权限
- AI 功能的准确性需要通过使用数据进行训练和优化
- 系统性能需要根据实际使用情况进行调优

---

**设计理念**：将企业级数据架构的强大能力带给个人用户，通过智能化的生活管理系统，帮助用户更好地组织时间、管理任务、追踪目标，最终提升生活质量和工作效率。