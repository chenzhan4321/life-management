<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>生活管理系统 - v2.4 最终修复版</title>
    
    <!-- 禁用所有缓存 -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <style>
    /* 完全内联的CSS - 无外部依赖 */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: white;
        padding: 20px;
        line-height: 1.6;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
        border: 1px solid rgba(255, 255, 255, 0.18);
    }

    .header {
        text-align: center;
        margin-bottom: 40px;
        padding-bottom: 20px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }

    .header h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
        background: linear-gradient(45deg, #fff, #f0f8ff);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .header p {
        font-size: 1.1rem;
        opacity: 0.9;
    }

    .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .stat-card {
        background: rgba(255, 255, 255, 0.15);
        padding: 20px;
        border-radius: 15px;
        text-align: center;
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .stat-number {
        font-size: 2rem;
        font-weight: bold;
        margin-bottom: 5px;
    }

    .stat-label {
        font-size: 0.9rem;
        opacity: 0.8;
    }

    .section {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 15px;
        padding: 25px;
        margin-bottom: 25px;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .section-title {
        font-size: 1.3rem;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .input-group {
        margin-bottom: 20px;
    }

    .input-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
    }

    textarea, input[type="text"] {
        width: 100%;
        padding: 15px;
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 10px;
        background: rgba(255, 255, 255, 0.1);
        color: white;
        font-size: 1rem;
        resize: vertical;
        font-family: inherit;
    }

    textarea::placeholder, input::placeholder {
        color: rgba(255, 255, 255, 0.7);
    }

    .button-group {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
        margin-top: 20px;
    }

    .btn {
        padding: 12px 25px;
        border: none;
        border-radius: 25px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
        text-decoration: none;
        color: white;
    }

    .btn-primary {
        background: linear-gradient(45deg, #667eea, #764ba2);
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
    }

    .btn-success {
        background: linear-gradient(45deg, #4CAF50, #45a049);
        box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
    }

    .btn-success:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(76, 175, 80, 0.6);
    }

    .btn-danger {
        background: linear-gradient(45deg, #f44336, #d32f2f);
        box-shadow: 0 4px 15px rgba(244, 67, 54, 0.4);
    }

    .btn-danger:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(244, 67, 54, 0.6);
    }

    .btn-secondary {
        background: linear-gradient(45deg, #6c757d, #5a6268);
        box-shadow: 0 4px 15px rgba(108, 117, 125, 0.4);
    }

    .task-list {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    .task-item {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        padding: 20px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        display: flex;
        align-items: center;
        gap: 15px;
        transition: all 0.3s ease;
    }

    .task-item:hover {
        background: rgba(255, 255, 255, 0.15);
        transform: translateY(-2px);
    }

    .task-checkbox {
        width: 20px;
        height: 20px;
        cursor: pointer;
        border-radius: 4px;
    }

    .task-content {
        flex: 1;
    }

    .task-title {
        font-weight: 600;
        font-size: 1.1rem;
        margin-bottom: 5px;
    }

    .task-meta {
        display: flex;
        gap: 15px;
        font-size: 0.9rem;
        opacity: 0.8;
        flex-wrap: wrap;
    }

    .task-actions {
        display: flex;
        gap: 10px;
    }

    .task-actions .btn {
        padding: 8px 15px;
        font-size: 0.9rem;
    }

    .domain-tag {
        padding: 4px 12px;
        border-radius: 15px;
        font-size: 0.8rem;
        font-weight: 500;
    }

    .domain-academic { background: rgba(66, 133, 244, 0.3); }
    .domain-income { background: rgba(52, 168, 83, 0.3); }
    .domain-growth { background: rgba(251, 188, 4, 0.3); }
    .domain-life { background: rgba(234, 67, 53, 0.3); }

    .task-item.completed {
        opacity: 0.6;
    }

    .task-item.completed .task-title {
        text-decoration: line-through;
    }

    .task-item.in-progress {
        background: rgba(76, 175, 80, 0.1);
        border-color: rgba(76, 175, 80, 0.3);
    }

    .toast {
        position: fixed;
        bottom: 30px;
        right: 30px;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 15px 25px;
        border-radius: 10px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        transform: translateY(100px);
        opacity: 0;
        transition: all 0.3s ease;
        z-index: 1000;
        backdrop-filter: blur(10px);
    }

    .toast.show {
        transform: translateY(0);
        opacity: 1;
    }

    .toast.success { background: rgba(76, 175, 80, 0.9); }
    .toast.error { background: rgba(244, 67, 54, 0.9); }
    .toast.info { background: rgba(33, 150, 243, 0.9); }

    .hidden { display: none !important; }

    .loading {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 15px;
        background: rgba(102, 126, 234, 0.1);
        border-radius: 10px;
        border: 1px solid rgba(102, 126, 234, 0.3);
        margin: 15px 0;
    }

    .spinner {
        width: 20px;
        height: 20px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-top-color: white;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    .empty-state {
        text-align: center;
        padding: 40px 20px;
        opacity: 0.7;
        font-style: italic;
    }

    /* 响应式设计 */
    @media (max-width: 768px) {
        body {
            padding: 15px;
        }
        
        .container {
            padding: 20px;
        }
        
        .header h1 {
            font-size: 2rem;
        }
        
        .stats {
            grid-template-columns: 1fr 1fr;
        }
        
        .button-group {
            flex-direction: column;
        }
        
        .btn {
            justify-content: center;
        }
        
        .task-item {
            flex-direction: column;
            align-items: flex-start;
        }
        
        .task-actions {
            width: 100%;
            justify-content: space-between;
        }
    }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎯 生活管理系统</h1>
            <p>v2.4 最终修复版 - 完全无缓存版本</p>
        </div>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="totalTasks">3</div>
                <div class="stat-label">总任务数</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="completedTasks">1</div>
                <div class="stat-label">已完成</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="pendingTasks">2</div>
                <div class="stat-label">待处理</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="productivity">33%</div>
                <div class="stat-label">完成率</div>
            </div>
        </div>

        <div class="section">
            <div class="section-title">
                ✨ AI 智能任务处理
            </div>
            <div class="input-group">
                <label>任务内容（支持多行输入或分号分隔）:</label>
                <textarea id="aiInput" rows="4" placeholder="输入任务内容，例如：
回复 Tony 的邮件
研究 OCR 错误检测方法
整理出差票据给雪媚

或分号分隔：回复邮件；整理文档；开会讨论"></textarea>
            </div>
            <div class="button-group">
                <button class="btn btn-primary" onclick="processAITasks()">
                    <span>✨</span> AI 智能处理
                </button>
                <button class="btn btn-secondary" onclick="clearAIInput()">
                    清空
                </button>
            </div>
            <div id="aiLoading" class="loading hidden">
                <div class="spinner"></div>
                <span>AI 正在分析和分类任务...</span>
            </div>
        </div>

        <div class="section">
            <div class="section-title">
                🚀 快速添加任务
            </div>
            <div class="input-group">
                <input type="text" id="quickInput" placeholder="输入任务标题（按Enter快速添加）" onkeypress="if(event.key==='Enter'){addQuickTask();}">
            </div>
            <div class="button-group">
                <button class="btn btn-success" onclick="addQuickTask()">
                    <span>➕</span> 立即添加
                </button>
            </div>
        </div>

        <div class="section">
            <div class="section-title">
                📋 今日任务列表
            </div>
            <div class="button-group">
                <button class="btn btn-primary" onclick="optimizeSchedule()">
                    <span>🧠</span> AI 优化排序
                </button>
                <button class="btn btn-secondary" onclick="refreshTasks()">
                    <span>🔄</span> 刷新
                </button>
                <button class="btn btn-danger" onclick="clearCompleted()">
                    <span>🗑️</span> 清空已完成
                </button>
            </div>
            
            <div class="task-list" id="taskList">
                <!-- 任务将在这里动态生成 -->
            </div>
        </div>
    </div>

    <div id="toastContainer"></div>

    <script>
    // 完全静态模式 - 无任何外部依赖
    let tasks = [
        {
            id: 1,
            title: "回复 Tony 的邮件",
            domain: "academic",
            status: "pending",
            estimatedHours: 0.5,
            plannedTime: "09:00",
            createdAt: new Date().toISOString()
        },
        {
            id: 2,
            title: "研究 OCR 错误检测方法",
            domain: "academic", 
            status: "in_progress",
            estimatedHours: 2,
            plannedTime: "10:00",
            createdAt: new Date().toISOString()
        },
        {
            id: 3,
            title: "整理出差票据给雪媚",
            domain: "life",
            status: "completed",
            estimatedHours: 0.25,
            plannedTime: "14:00",
            createdAt: new Date().toISOString(),
            completedAt: new Date().toISOString()
        }
    ];

    let nextTaskId = 4;

    // 域名映射
    const domainMap = {
        academic: { name: '学术', color: 'academic' },
        income: { name: '收入', color: 'income' },
        growth: { name: '成长', color: 'growth' },
        life: { name: '生活', color: 'life' }
    };

    // Toast 提示函数
    function showToast(message, type = 'info') {
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        toast.textContent = message;
        
        document.getElementById('toastContainer').appendChild(toast);
        
        setTimeout(() => toast.classList.add('show'), 100);
        
        setTimeout(() => {
            toast.classList.remove('show');
            setTimeout(() => toast.remove(), 300);
        }, 3000);
    }

    // AI 处理任务
    function processAITasks() {
        const input = document.getElementById('aiInput');
        const text = input.value.trim();
        
        if (!text) {
            showToast('请输入任务内容', 'error');
            return;
        }

        document.getElementById('aiLoading').classList.remove('hidden');
        
        setTimeout(() => {
            const taskTexts = text.includes(';') ? 
                text.split(';').map(t => t.trim()).filter(t => t) :
                text.split('\n').map(t => t.trim()).filter(t => t);
            
            taskTexts.forEach(taskText => {
                const newTask = {
                    id: nextTaskId++,
                    title: taskText,
                    domain: inferDomain(taskText),
                    status: "pending",
                    estimatedHours: inferHours(taskText),
                    plannedTime: inferTime(),
                    createdAt: new Date().toISOString()
                };
                
                tasks.push(newTask);
            });
            
            document.getElementById('aiLoading').classList.add('hidden');
            input.value = '';
            refreshTasks();
            showToast(`AI 成功处理 ${taskTexts.length} 个任务`, 'success');
        }, 2000);
    }

    // 推断任务域
    function inferDomain(text) {
        const keywords = {
            academic: ['研究', '论文', '学习', '邮件', '会议', '分析'],
            income: ['工作', '项目', '客户', '收入', '业务'],
            growth: ['技能', '培训', '课程', '学习'],
            life: ['票据', '整理', '生活', '家务', '购物']
        };
        
        for (const [domain, words] of Object.entries(keywords)) {
            if (words.some(word => text.includes(word))) {
                return domain;
            }
        }
        return 'academic';
    }

    // 推断时间
    function inferHours(text) {
        if (text.includes('30分钟')) return 0.5;
        if (text.includes('1小时')) return 1;
        if (text.includes('2小时')) return 2;
        return 1;
    }

    // 推断开始时间
    function inferTime() {
        const hour = new Date().getHours();
        if (hour < 12) return '10:00';
        if (hour < 14) return '14:00';
        if (hour < 17) return '15:00';
        return '19:00';
    }

    // 清空AI输入
    function clearAIInput() {
        document.getElementById('aiInput').value = '';
    }

    // 快速添加任务
    function addQuickTask() {
        const input = document.getElementById('quickInput');
        const title = input.value.trim();
        
        if (!title) {
            showToast('请输入任务标题', 'error');
            return;
        }
        
        const newTask = {
            id: nextTaskId++,
            title: title,
            domain: 'academic',
            status: 'pending',
            estimatedHours: 1,
            plannedTime: inferTime(),
            createdAt: new Date().toISOString()
        };
        
        tasks.push(newTask);
        input.value = '';
        refreshTasks();
        showToast('任务添加成功', 'success');
    }

    // 切换任务状态
    function toggleTask(taskId) {
        const task = tasks.find(t => t.id === taskId);
        if (!task) return;
        
        if (task.status === 'completed') {
            task.status = 'pending';
            task.completedAt = null;
            showToast('任务标记为未完成', 'info');
        } else {
            task.status = 'completed';
            task.completedAt = new Date().toISOString();
            showToast('✅ 任务已完成！', 'success');
        }
        
        refreshTasks();
    }

    // 开始任务
    function startTask(taskId) {
        const task = tasks.find(t => t.id === taskId);
        if (!task) return;
        
        task.status = 'in_progress';
        showToast(`开始执行: ${task.title}`, 'success');
        refreshTasks();
    }

    // 暂停任务
    function pauseTask(taskId) {
        const task = tasks.find(t => t.id === taskId);
        if (!task) return;
        
        task.status = 'pending';
        showToast(`暂停任务: ${task.title}`, 'info');
        refreshTasks();
    }

    // 删除任务
    function deleteTask(taskId) {
        if (!confirm('确定要删除这个任务吗？')) return;
        
        tasks = tasks.filter(t => t.id !== taskId);
        refreshTasks();
        showToast('任务已删除', 'info');
    }

    // 优化日程
    function optimizeSchedule() {
        showToast('AI 正在优化您的任务排序...', 'info');
        
        setTimeout(() => {
            // 简单的优化逻辑：按优先级和时间排序
            tasks.sort((a, b) => {
                if (a.status === 'in_progress' && b.status !== 'in_progress') return -1;
                if (b.status === 'in_progress' && a.status !== 'in_progress') return 1;
                if (a.status === 'completed' && b.status !== 'completed') return 1;
                if (b.status === 'completed' && a.status !== 'completed') return -1;
                return a.estimatedHours - b.estimatedHours;
            });
            
            refreshTasks();
            showToast('✨ 任务排序优化完成', 'success');
        }, 1500);
    }

    // 清空已完成任务
    function clearCompleted() {
        const completedCount = tasks.filter(t => t.status === 'completed').length;
        
        if (completedCount === 0) {
            showToast('没有已完成的任务', 'info');
            return;
        }
        
        if (!confirm(`确定要清空 ${completedCount} 个已完成任务吗？`)) return;
        
        tasks = tasks.filter(t => t.status !== 'completed');
        refreshTasks();
        showToast(`已清空 ${completedCount} 个已完成任务`, 'success');
    }

    // 刷新任务列表
    function refreshTasks() {
        updateStats();
        renderTasks();
    }

    // 更新统计信息
    function updateStats() {
        const total = tasks.length;
        const completed = tasks.filter(t => t.status === 'completed').length;
        const pending = tasks.filter(t => t.status !== 'completed').length;
        const productivity = total > 0 ? Math.round((completed / total) * 100) : 0;
        
        document.getElementById('totalTasks').textContent = total;
        document.getElementById('completedTasks').textContent = completed;
        document.getElementById('pendingTasks').textContent = pending;
        document.getElementById('productivity').textContent = productivity + '%';
    }

    // 渲染任务列表
    function renderTasks() {
        const container = document.getElementById('taskList');
        
        if (tasks.length === 0) {
            container.innerHTML = '<div class="empty-state">还没有任务，开始添加一些任务吧！</div>';
            return;
        }
        
        container.innerHTML = tasks.map(task => {
            const domain = domainMap[task.domain];
            return `
                <div class="task-item ${task.status}">
                    <input type="checkbox" class="task-checkbox" 
                           ${task.status === 'completed' ? 'checked' : ''} 
                           onchange="toggleTask(${task.id})">
                    <div class="task-content">
                        <div class="task-title">${task.title}</div>
                        <div class="task-meta">
                            <span class="domain-tag domain-${domain.color}">${domain.name}</span>
                            <span>预计 ${task.estimatedHours}小时</span>
                            <span>计划 ${task.plannedTime}</span>
                            ${task.status === 'completed' ? '<span>✅ 已完成</span>' : ''}
                        </div>
                    </div>
                    <div class="task-actions">
                        ${task.status === 'pending' ? `
                            <button class="btn btn-success" onclick="startTask(${task.id})">
                                <span>▶️</span> 开始
                            </button>
                        ` : ''}
                        ${task.status === 'in_progress' ? `
                            <button class="btn btn-secondary" onclick="pauseTask(${task.id})">
                                <span>⏸️</span> 暂停
                            </button>
                        ` : ''}
                        <button class="btn btn-danger" onclick="deleteTask(${task.id})">
                            <span>🗑️</span>
                        </button>
                    </div>
                </div>
            `;
        }).join('');
    }

    // 页面加载完成后初始化
    document.addEventListener('DOMContentLoaded', function() {
        refreshTasks();
        showToast('🎯 生活管理系统已加载 - 无缓存版本', 'success');
    });
    </script>
</body>
</html>